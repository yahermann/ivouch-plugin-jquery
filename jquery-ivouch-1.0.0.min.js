(function(e){e.fn.ivouch=function(t){var n=e.extend({key:"",onload:function(e){},onerror:function(e){},reviews_start:undefined,reviews_num:undefined,reviews_sortby:undefined,default_author_photo_url:"//open.ivouch.com/v1/static/img/author_nophoto_sm.gif",endpoint:"//open.ivouch.com/v1/api/"},t);var r=function(e){return e.replace(/</g,"<").replace(/>/g,">").replace(/\n/g,"<br/>").replace(/"/g,""")};var i=function(t,i){t.find(".reviews").each(function(){var t=e(this).html();var s="";if(i.reviews){for(var o=0;o<i.reviews.length;o++){s+=t.replace(/\<!\-\-([^%]*)%%([a-z_]+)%%([^%]*)\-\-\>/gi,function(e,t,s,u){var a=typeof i.reviews[o][s]==="string"?i.reviews[o][s]:typeof i.reviews[o][s]==="number"?i.reviews[o][s].toString():"";switch(s){case"written_dt":a=(new Date(a)).toLocaleDateString()+"   "+(new Date(a)).toLocaleTimeString();break;default:a=r(a);break}return t+(a.length>0?a:n["default_"+s]||"")+u})}}e(this).html(s)});t.html(t.html().replace(/\<!\-\-([^%]*)%%([a-z_]+)%%([^%]*)\-\-\>/gi,function(e,t,s,o){var u=typeof i[s]==="string"?i[s]:typeof i[s]==="number"?i[s].toString():"";u=r(u);return t+(u.length>0?u:n["default_"+s]||"")+o}))};var s={};return this.each(function(){var t=e(this);var r=t.attr("rel");if(typeof s[r]==="undefined"){s[r]=e.ajax({type:"GET",dataType:"jsonp",url:n.endpoint+"topic/id="+r+"&key="+n.key+(typeof n.reviews_start!=="undefined"?"&reviews_start="+n.reviews_start:"")+(typeof n.reviews_num!=="undefined"?"&reviews_num="+n.reviews_num:"")+(typeof n.reviews_sortby!=="undefined"?"&reviews_sortby="+n.reviews_sortby:"")+"&callback=?"})}s[r].done(function(e){if(e.error){if(typeof n.onerror==="function"&&n.onerror(e.error)===false){return}alert(e.error)}if(typeof n.onload==="function"&&n.onload(e)===false){return}i(t,e)});s[r].fail(function(e){var t="http "+e.status+" error";if(typeof n.onerror==="function"&&n.onerror(t)===false){return}alert(t)})})}})(jQuery)